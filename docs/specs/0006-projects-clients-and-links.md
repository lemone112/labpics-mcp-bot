# Спека 0006 — Проекты, клиенты и связывание идентичностей (DRAFT)

Статус: **draft**

## Цель

Сделать так, чтобы система могла **без хаоса** связывать:

- проекты студии
- клиентов (компания/контакты/сделки)
- внешние источники (Chatwoot, Linear, Attio)

…и при этом сохранять:

- строгую изоляцию по проектам
- evidence-first
- удобство для PM/Owner

## Базовые определения

### Проект

**Проект** — основная рабочая единица. Всё операционное (память, commitments, risks, digest, действия) живёт внутри проекта.

### Клиент

**Клиент** — профиль сущности “с кем мы работаем”. В реальности это часто:

- компания (основной якорь)
- контакты
- иногда сделка

Важно: один клиент может иметь много проектов.

### Внешняя идентичность

**Внешняя идентичность** — стабильный идентификатор объекта во внешней системе:

- Chatwoot: inbox / conversation / contact
- Linear: project / issue
- Attio: company / person / deal

## Принципы (главное)

### 1) Проект — центр операционной модели

- Поиск/память/commitments/risks/digest строго project-scoped.
- Даже если у клиента несколько проектов, память не должна смешиваться.

### 2) Клиент — отдельная сущность (но допускаем упрощение)

Система должна поддерживать оба режима:

- **Нормальный режим**: `client` отдельно, `project` ссылается на `client`.
- **Упрощённый режим**: “проект = клиент” (когда клиент один и не хочется заводить лишнее).

### 3) Связывание не должно быть магией

Авто-связывание допустимо только если оно:

- объяснимо
- обратимо
- не ведёт к утечкам между проектами

Если система не уверена — она должна предложить пользователю выбор.

### 4) Не один источник правды, а один «источник правды внутри системы»

Внешние системы могут конфликтовать. Источник правды для продукта — **наша БД**, куда попадают:

- raw данные
- ссылки на внешние сущности
- производные сущности

Внешние системы обновляются только через контролируемые действия (preview/approve).

## Семантика связей (Links)

### Что такое “link”

Link — это утверждение «внутренний объект связан с внешней сущностью».

Примеры:

- проект ↔ chatwoot inbox
- проект ↔ linear project
- клиент ↔ attio company
- проект ↔ клиент

### Свойства link (семантически)

Каждый link должен хранить:

- *тип* связи (какого рода объект)
- *внешний id* (стабильный)
- *url* (опционально)
- *уверенность/источник* (кто создал: человек/авто)

### Правила

- Один внешний объект не должен “прилипать” к двум проектам там, где это опасно (например inbox).
- Там, где допустимо разделение (например client ↔ company), допускается много проектов к одному клиенту.

## UX (как пользователь это делает)

### Создание проекта

При создании проекта пользователь должен иметь возможность:

- указать клиента (опционально)
- связать проект с inbox Chatwoot (1..N)
- связать с Linear project (опционально)
- связать с Attio company (опционально)

### Раздел “Связи проекта”

В проекте должна быть страница/вкладка, где видно:

- какие внешние сущности привязаны
- какие нет
- что нужно добавить для корректной работы памяти/джоб

### Предложения от системы

Система может предложить:

- “похоже, этот inbox относится к проекту X”
- “похоже, этот Attio company — ваш клиент”

Но пользователь должен подтверждать.

## Acceptance criteria

1. Один клиент может иметь несколько проектов без смешивания памяти.
2. Inbox Chatwoot нельзя случайно привязать к двум проектам.
3. Пользователь всегда видит, что с чем связано.
4. Любое авто-связывание либо подтверждается человеком, либо остаётся в “предложениях”.
5. Изменение связей не приводит к утечкам между проектами.

## Вне рамок (пока)

- Авто-мердж дублей клиентов
- Сложные правила сопоставления по доменам/именам
