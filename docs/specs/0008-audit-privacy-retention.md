# Спека 0008 — Аудит, приватность, retention и безопасность (DRAFT)

Статус: **draft**

## Цель

Сделать систему безопасной для B2B-использования:

- минимизировать риски утечек и неправильного хранения клиентских данных
- обеспечить разбор инцидентов (“почему агент так решил”)
- контролировать срок хранения чувствительных данных

## Принципы

1. **Минимизация данных.** Храним только то, что нужно для продукта.
2. **Ссылки лучше копий.** Предпочитаем хранить ссылки на первоисточник вместо дублирования текста.
3. **Ограничение доступа.** Не показывать сырой контент в местах, где он не нужен.
4. **Retention по умолчанию.** Старые служебные данные должны очищаться.
5. **Безопасность действий.** Автоматические действия не должны ломать внешние системы.

## Классы данных

### 1) Raw данные (переписки)

- потенциально содержат PII
- нужны для воспроизводимости и evidence

Политика:

- хранятся как “сырьё” для построения памяти
- UI показывает их только в контексте evidence (по запросу пользователя)

### 2) Память/фрагменты

- производные фрагменты для поиска
- могут содержать PII

Политика:

- хранить только то, что нужно для retrieval
- не публиковать фрагменты между проектами

### 3) Производные сущности (commitments/risks/digests)

- должны содержать ссылки на evidence
- должны быть безопасны для распространения внутри команды

Политика:

- если есть сомнения в приватности — показывать сокращённый текст + ссылку на источник

### 4) Аудит (agent runs, actions)

Нужен, чтобы:

- разбирать ошибки
- улучшать промпты/правила
- доказывать “что именно было сделано”

Политика:

- хранить структурированные входы/выходы
- хранить ссылки на источники
- хранить только короткие фрагменты текста (truncation)

## Что обязательно аудитировать

1. Запуски извлечения commitments/risks
2. Генерацию дайджеста
3. Любые интеграционные предложения (preview)
4. Любые применённые действия (apply)

Для каждого события хранить:

- время
- проект
- кто инициировал (пользователь/cron)
- что было входом (структурно)
- что было выходом (структурно)
- какие evidence использовались
- успех/ошибка

## Retention

### Рекомендация по срокам

- Аудит-логи: 30–90 дней
- Промежуточные/технические статусы: 7–30 дней
- Raw переписки: по бизнес-политике (часто дольше), но с доступом “по необходимости”

### Поведение

- Система должна иметь понятный механизм очистки по сроку.
- Очистка не должна ломать ссылки в commitments/risks (если удаляем текст, сохраняем минимальные метаданные/ids).

## Маскирование и редактирование

- В UI по умолчанию не показывать полный сырой текст в списках.
- При необходимости показывать:
  - сокращённый фрагмент
  - кнопку “показать полностью”

## Безопасность интеграций

- Любое изменение внешней системы должно быть:
  - идемпотентным
  - аудируемым
  - и по умолчанию требовать подтверждения

## Acceptance criteria

1. Можно ответить на вопрос: “почему commitment/risk появился?”
2. Можно ответить на вопрос: “кто применил изменение в Linear/Attio и что именно?”
3. Есть понятный срок хранения для аудита.
4. По умолчанию UI не разбрасывает PII в списках.
