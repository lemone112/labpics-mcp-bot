# Product Decisions — 2026-02-20

> Зафиксированные архитектурные решения по результатам Q&A-сессии.
> Источник: interactive session, 7 раундов вопросов по всем областям продукта.

---

## 1. Telegram Bot — UX Architecture

### Пользователи и роли
- **Owner + PM** с разным UX
- PM: полный CRUD своих проектов (задачи, сделки, офферы)
- Owner: всё + team overview + мониторинг системы + управление настройками
- Количество юзеров: 1-3 человека

### Навигация и управление
- **Только кнопки** (inline keyboards). Текстовый ввод допустим при создании задачи/сделки
- **2-3 сообщения** на экран (основное с кнопками + детали). Старые удаляются при навигации
- **Только личный чат** (без групповых)
- **Язык:** русский

### Проектный scope
- Зависит от экрана: дайджесты = кросс-проект, задачи/CRM = конкретный проект
- Переключение проекта через кнопку

---

## 2. Telegram Bot — Функциональность

### Приоритет реализации
1. **Задачи** (Linear) — адаптивный wizard
2. **CRM** (Attio) — полный pipeline
3. **Дайджесты** — ежедневный + еженедельный

### Задачи (Linear)
- Создание: название (текст) + проект (кнопки) — обязательно
- Опциональные кнопки: "Добавить исполнителя", "Приоритет", "Дедлайн"
- Проекты и задачи создаются через Linear API (Composio)

### CRM (Attio)
- Полный pipeline: создание сделки → перемещение по стадиям → закрытие (won/lost)
- 9 стадий из `bot.deal_stages`
- Deal won → подтверждение "Создать проект в Linear?" → создание с задачами

### Search (LightRAG)
- **Готовые шаблоны** — кнопки с предзаданными запросами
- Без текстового ввода для поиска

### Мониторинг (Owner only)
- Owner видит статус коннекторов, ошибки, последний синк
- Может запустить sync

### Approvals
- Push-уведомление "Новый оффер на аппрув" → кнопки Approve/Reject

### Сообщения Chatwoot
- Только просмотр (без ответов из бота)

### NBA (Next Best Action)
- Accept + Dismiss + Snooze кнопки

### Аналитика
- Отдельный экран с ключевыми KPI (текстом)

### Настройки
- Полный контроль: время дайджестов, 10+ категорий push, секции, профиль

---

## 3. Дайджесты

### Расписание
| Тип | Время | Содержание |
|-----|-------|------------|
| Ежедневный (утро) | 10:00 МСК | План дня |
| Ежедневный (вечер) | 19:00 МСК | Итоги дня |
| Еженедельный (пт) | 19:00 МСК | Итоги недели |
| Еженедельный (пн) | 10:00 МСК | План на неделю |

### Ежедневный — содержание
- **Задачи (Linear):** закрыто/просрочено/новые/blocked
- **Коммуникации:** новые сообщения, неотвеченные, среднее время ответа
- **CRM pipeline:** won/lost/перемещения по стадиям
- **Сигналы + top NBA:** критические сигналы + топ рекомендаций

### Еженедельный — содержание
- **Выручка + pipeline:** WoW динамика, win rate
- **Здоровье проектов:** health score по проектам, топ риски
- **Продуктивность:** задачи закрыто vs создано (velocity)
- **Офферы + конверсия:** отправлено/принято, суммы

### UX
- Сообщение + кнопки drill-down по каждому проекту

---

## 4. Push-уведомления (гранулярные, 10+ тоглов)

1. Задачи: overdue
2. Задачи: new assigned
3. Задачи: blocked
4. Сделки: won
5. Сделки: lost
6. Сделки: stage change
7. Сообщения: new from client
8. Сообщения: unanswered >N hours
9. Сигналы: critical (severity >= 4)
10. Офферы: pending approval
11. Система: connector sync failed >1h
12. Система: job failed
13. Молчание клиента: threshold exceeded

---

## 5. Сигналы — Расширение

### Текущие (6 regex)
`delivery_risk`, `commercial_pressure`, `upsell_intent`, `urgency_increase`, `delivery_overdue`, `deal_without_next_step`

### Новые типы
| Сигнал | Источник | Реализация |
|--------|---------|------------|
| `client_silence` | Chatwoot | 3 дня (активный) / 7 дней (пауза) |
| `sentiment_negative` | Chatwoot | Батч 5-10 сообщений → LLM (GPT-4o-mini) |
| `sentiment_positive` | Chatwoot | Батч → LLM (для upsell timing) |
| `scope_creep` | Linear | >30% роста задач vs еженедельный снэпшот |
| `satisfaction_drop` | Комбо | Авто-метрики + NPS через Chatwoot |

---

## 6. Риски — Гранулярность

### Новая модель (3 типа)
| Тип | Источники |
|-----|-----------|
| **Сроки** | Overdue issues, blocked tasks, delivery_risk signals |
| **Бюджет** | Пока нет данных (T&M позже) |
| **Объём работ** | scope_creep signal, рост задач vs baseline |

---

## 7. Скидки — Новые факторы

| Фактор | Описание |
|--------|----------|
| **LTV / история** | Кол-во завершённых проектов |
| **Поведение клиента** | Правки, скорость ответа, ТЗ |
| **Объём заказа** | Сумма влияет на размер скидки |

---

## 8. Офферы

- **Авто-генерация** на основе upsell_intent + прайс-лист в базе
- **Прайс-лист:** диапазоны + пакеты + почасовая (T&M)
- **Категории:** Брендинг, Веб-дизайн, UX/UI продукты
- **Канал:** Copy + вручную (PM копирует текст)

---

## 9. Прогнозирование — Полная модель

- Win rate по стадиям (исторический %)
- MoM/QoQ тренд
- Прогноз на 3 месяца (pipeline × win rate + trend)

---

## 10. Модель данных — Клиент

- **1 клиент = N проектов**
- **Страница клиента:** история проектов + LTV + контакты + удовлетворённость
- **Identity Graph:** + exact email + телефон
- **NPS/CSAT:** через Chatwoot автоматически

---

## 11. Инфраструктура

- **Единый бэкенд** (Fastify API) для дашборда и бота
- Supabase — только для bot state (drafts, settings, picker)
- Бизнес-данные — через Fastify API
